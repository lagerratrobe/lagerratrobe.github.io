<h1>Getting Mapserver and PostGIS installed on Windows 10 WSL</h1>
<h4>I.  Set the system locale to "en_US.UTF-8"</h4>
<p>For some reason, the WSL system locale isn't set and this causes problems later when you want to create a UTF-8 encoded Database. </p>
<p><strong>Note:</strong> Do this as root.</p>
<pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo su -</span>
<span class="hljs-meta">#</span><span class="bash"> sudo locale-gen <span class="hljs-string">"en_US.UTF-8"</span></span>
<span class="hljs-meta">#</span><span class="bash"> update-locale LANG=en_US.UTF-8 LANGUAGE=en_US.UTF-8</span></code></pre>
<p>Verify that we have something in the <em>/etc/default/locale</em> file now: (Was originally blank)</p>
<pre><code class="hljs routeros"><span class="hljs-comment"># cat /etc/default/locale</span>
    #  File generated by update-locale
    <span class="hljs-attribute">LANGUAGE</span>=en_US.UTF-8
    <span class="hljs-attribute">LANG</span>=en_US.UTF-8</code></pre>
<h4>II.  Add the ubuntugis PPA and install some GIS packages</h4>
<pre><code class="hljs routeros">$ sudo add-apt-repository ppa:ubuntugis/ppa
$ sudo apt-<span class="hljs-builtin-name">get</span> update
$ sudo apt-<span class="hljs-builtin-name">get</span> install cgi-mapserver
$ sudo apt-<span class="hljs-builtin-name">get</span> install mapserver-bin
$ sudo apt-<span class="hljs-builtin-name">get</span> install python-mapscript
$ sudo apt-<span class="hljs-builtin-name">get</span> install apache2
$ sudo apt-<span class="hljs-builtin-name">get</span> install libgdal-dev gdal-bin
$ sudo apt-<span class="hljs-builtin-name">get</span> install postgresql-9.5 postgresql-contrib-9.5 postgresql-9.5-postgis-2.3

<span class="hljs-comment"># In the output you'll see this after installing postgres</span>
Creating new cluster 9.5/main <span class="hljs-built_in">..</span>.
 <span class="hljs-built_in"> config </span>/etc/postgresql/9.5/main
  data   /var/lib/postgresql/9.5/main
  locale C
  socket /var/run/postgresql
 <span class="hljs-built_in"> port </span>  5432</code></pre>
<h4>III.  Check versions of programs</h4>
<pre><code class="hljs routeros">$ psql --version
psql (PostgreSQL) 9.5.10

$ gdalinfo --version
GDAL 2.1.3, released 2017/20/01

$ proj
Rel. 4.9.2, 08 September 2015
usage: proj [ -beEfiIlormsStTvVwW [args] ] [ +opts[=arg] ] [ files ]

~$ geos-config --version
3.5.1

$ mapserv -v
MapServer version 7.0.4 <span class="hljs-attribute">OUTPUT</span>=PNG <span class="hljs-attribute">OUTPUT</span>=JPEG <span class="hljs-attribute">OUTPUT</span>=KML <span class="hljs-attribute">SUPPORTS</span>=PROJ <span class="hljs-attribute">SUPPORTS</span>=AGG <span class="hljs-attribute">SUPPORTS</span>=FREETYPE <span class="hljs-attribute">SUPPORTS</span>=CAIRO <span class="hljs-attribute">SUPPORTS</span>=SVG_SYMBOLS <span class="hljs-attribute">SUPPORTS</span>=RSVG <span class="hljs-attribute">SUPPORTS</span>=ICONV <span class="hljs-attribute">SUPPORTS</span>=FRIBIDI <span class="hljs-attribute">SUPPORTS</span>=WMS_SERVER <span class="hljs-attribute">SUPPORTS</span>=WMS_CLIENT <span class="hljs-attribute">SUPPORTS</span>=WFS_SERVER <span class="hljs-attribute">SUPPORTS</span>=WFS_CLIENT <span class="hljs-attribute">SUPPORTS</span>=WCS_SERVER <span class="hljs-attribute">SUPPORTS</span>=SOS_SERVER <span class="hljs-attribute">SUPPORTS</span>=FASTCGI <span class="hljs-attribute">SUPPORTS</span>=THREADS <span class="hljs-attribute">SUPPORTS</span>=GEOS <span class="hljs-attribute">INPUT</span>=JPEG <span class="hljs-attribute">INPUT</span>=POSTGIS <span class="hljs-attribute">INPUT</span>=OGR <span class="hljs-attribute">INPUT</span>=GDAL <span class="hljs-attribute">INPUT</span>=SHAPEFILE</code></pre>
<h4>IV.  Setup postgres:</h4>
<p>(Need to be root to reset postgres passwd because WSL sudoers file isn't recognized for some reason)</p>
<ul>
<li>Start postgres server:</li>
</ul>
<pre><code class="hljs routeros">$ sudo su -
<span class="hljs-comment"># sudo /etc/init.d/postgresql start</span>
 * Starting PostgreSQL 9.5 database<span class="hljs-built_in"> server </span>           [ OK ]</code></pre>
<ul>
<li>Set a passwd for the DB postgres user<br>
This command will drop you into the psql prompt as theDB user "postgres".  Once in psql, you can specify a new user for that "postgres" user.  Pick something memorable, like "<em>postgres</em>".</li>
</ul>
<pre><code class="hljs makefile"><span class="hljs-comment"># sudo -u postgres psql postgres</span>
postgres=<span class="hljs-comment"># \password postgres</span>
Enter new password:
Enter it again:
postgres=<span class="hljs-comment"># \q</span></code></pre>
<ul>
<li>Add a postgres user that matches your local username<br>
You really shouldn't always use your database as the "postgres" user, although really in this setup, I'm doing this more for ease of use, than for security.</li>
</ul>
<pre><code class="hljs haxe"><span class="hljs-meta"># sudo -u postgres createuser -P randre</span>
Enter password <span class="hljs-keyword">for</span> <span class="hljs-keyword">new</span> <span class="hljs-type">role</span>:
Enter it again:<span class="hljs-type"></span></code></pre>
<ul>
<li>Create a new database</li>
</ul>
<pre><code class="hljs mathematica"># sudo -u postgres createdb -<span class="hljs-keyword">E</span> UTF8 -<span class="hljs-keyword">O</span> randre gis_data</code></pre>
<ul>
<li>Create postgis and hstore extensions:</li>
</ul>
<pre><code class="hljs gherkin"><span class="hljs-comment"># sudo su postgres</span>
$ psql -d gis_data

gis_data=<span class="hljs-comment"># create extension postgis;</span>
CREATE EXTENSION

gis_data=<span class="hljs-comment"># create extension hstore;</span>
CREATE EXTENSION

gis_data=<span class="hljs-comment"># \d</span>
               List of relations
 Schema |<span class="hljs-string">       Name        </span>|<span class="hljs-string"> Type  </span>|<span class="hljs-string">  Owner
--------+-------------------+-------+----------
 public </span>|<span class="hljs-string"> geography_columns </span>|<span class="hljs-string"> view  </span>|<span class="hljs-string"> postgres
 public </span>|<span class="hljs-string"> geometry_columns  </span>|<span class="hljs-string"> view  </span>|<span class="hljs-string"> postgres
 public </span>|<span class="hljs-string"> raster_columns    </span>|<span class="hljs-string"> view  </span>|<span class="hljs-string"> postgres
 public </span>|<span class="hljs-string"> raster_overviews  </span>|<span class="hljs-string"> view  </span>|<span class="hljs-string"> postgres
 public </span>|<span class="hljs-string"> spatial_ref_sys   </span>|<span class="hljs-string"> table </span>|<span class="hljs-string"> postgres
(5 rows)

# exit DB
gis_data=# \q</span></code></pre>
<ul>
<li>Grant privs to the local user on the newly create "gis_data" DB</li>
</ul>
<pre><code class="hljs elixir">postgres<span class="hljs-variable">@Cetautomatix</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>psql postgres

postgres=<span class="hljs-comment"># grant all privileges on database gis_data to "randre";</span>
GRANT</code></pre>
<h4>V.  Download and install PgAdminIII or QGis</h4>
<p>See if you can connect to your running instance (don't close your bash window while you're doing this, your DB is running inside it).  </p>
<p>Not bad for 20 minutes of watching <em>apt</em> do its thing while drinking bourbon.</p>